<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Iron Fx Recovery</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #090909;
      color: #fff;
    }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .main-container {
      flex: 1;
      display: flex;
      min-height: 0;
    }
    aside {
      width: 200px;
      background: #18191a;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      min-height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      z-index: 10;
      border-right: 1px solid #272727;
    }
    .sidebar-logo {
      padding: 32px 0 16px 0;
      text-align: center;
    }
    .sidebar-logo img {
      width: 90px;
      border-radius: 20px;
    }
    nav.sidebar-nav {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding: 10px 0;
    }
    nav.sidebar-nav button, nav.sidebar-nav a {
      display: block;
      padding: 12px 20px;
      background: none;
      border: none;
      color: #fff;
      text-align: left;
      font-size: 1.07em;
      cursor: pointer;
      border-left: 3px solid transparent;
      transition: background 0.18s, color 0.18s, border-color 0.2s;
      outline: none;
      border-radius: 0 16px 16px 0;
      font-weight: bold;
    }
    nav.sidebar-nav button.active, nav.sidebar-nav a.active {
      background: #232629;
      border-left: 3px solid #ff0000;
      color: #ff0000;
    }
    nav.sidebar-nav button:hover:not(.active), nav.sidebar-nav a:hover:not(.active) {
      background: #232323;
      color: #ff6363;
    }
    .logout-btn {
      margin: 20px 20px 20px 20px;
      align-self: flex-end;
      width: auto;
      padding: 5px 16px;
      font-size: 0.95em;
      background: #232323;
      color: #ff6363;
      border: 1px solid #444;
      border-radius: 8px;
      transition: background 0.2s, color 0.2s;
      cursor: pointer;
    }
    .logout-btn:hover {
      background: #ff0000;
      color: #fff;
    }
    header {
      background: #ff0000;
      text-align: center;
      padding: 14px 0 12px 200px;
      font-size: 1.45em;
      font-weight: bold;
      letter-spacing: .5px;
      position: sticky;
      top: 0;
      z-index: 2;
    }
    .content {
      margin-left: 200px;
      max-width: 900px;
      width: 100%;
      min-height: 80vh;
      padding: 40px 24px 20px 24px;
      box-sizing: border-box;
      display: block;
    }
    .panel {
      background: #151516;
      border-radius: 18px;
      box-shadow: 0 2px 30px #22000022;
      padding: 28px 24px;
      max-width: 400px;
      margin: auto;
      margin-bottom: 24px;
    }
    .panel h2 {
      margin-top: 0;
      color: #ff0000;
      letter-spacing: .5px;
    }
    .form-group {
      margin-bottom: 16px;
    }
    label {
      display: block;
      font-size: 1em;
      margin-bottom: 2px;
      color: #eee;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      background-color: #222;
      color: #fff;
      border: 1px solid #444;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 1em;
    }
    .panel button, .panel input[type="submit"] {
      background-color: #ff0000;
      border: none;
      cursor: pointer;
      font-weight: bold;
      border-radius: 8px;
      transition: background 0.18s;
      width: 100%;
      margin-top: 18px;
      padding: 10px 0;
      font-size: 1.09em;
    }
    .panel button:hover, .panel input[type="submit"]:hover {
      background-color: #d10000;
    }
    .msg {
      margin-top: 10px;
      font-size: 1em;
      text-align: center;
    }
    .msg.success {
      color: #0f0;
    }
    .msg.error {
      color: #f00;
    }
    .users-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 16px;
    }
    .users-table th, .users-table td {
      border: 1px solid #292929;
      padding: 8px 5px;
      text-align: left;
      font-size: .97em;
    }
    .users-table th {
      background: #2c2c2c;
      color: #ff6363;
    }
    .users-table tr:nth-child(even) {
      background: #191919;
    }
    .users-table tr.approved {
      background: #123c12;
      color: #92ffa1;
    }
    .users-table tr.rejected {
      background: #3c1212;
      color: #ffa192;
    }
    .admin-actions button {
      margin-right: 8px;
      margin-bottom: 2px;
      width: auto;
      padding: 5px 12px;
      font-size: .95em;
      background: #232323;
      color: #fff;
      border-radius: 7px;
      border: 1px solid #444;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      outline: none;
    }
    .admin-actions button.approve { color: #0f0; border-color: #0f0; }
    .admin-actions button.reject { color: #f00; border-color: #f00; }
    .admin-actions button:hover {
      background: #ff0000;
      color: #fff;
    }
    @media (max-width: 700px) {
      aside { width: 56px; }
      .sidebar-logo img { width: 38px; }
      .sidebar-logo { padding: 16px 0 9px 0; }
      nav.sidebar-nav button, nav.sidebar-nav a {
        font-size: 0.92em;
        padding: 12px 8px;
        border-radius: 0 9px 9px 0;
      }
      .content { margin-left: 56px; padding: 16px 5px 20px 5px; }
      header { padding-left: 56px; font-size: 1em; }
    }
  </style>
</head>
<body>
<aside id="sidebar" style="display:none;">
  <div class="sidebar-logo">
    <img src="icon-192.png" alt="Iron FX Logo">
  </div>
  <nav class="sidebar-nav" id="nav-menu">
    <button type="button" data-section="trading" class="active">Trading</button>
    <button type="button" data-section="deposito">Depósito</button>
    <button type="button" data-section="retiro">Retiro</button>
    <button type="button" data-section="admin" id="adminPanelBtn" style="display:none;">Panel Admin</button>
  </nav>
  <button id="logout-btn" class="logout-btn" title="Cerrar sesión">⎋</button>
</aside>

<header>
  Iron Fx Recovery
</header>

<main class="main-container">
  <section class="content" id="content-area">
    <!-- Login / Registro -->
    <div id="login-panel" class="panel" style="max-width:430px;">
      <h2>Iniciar Sesión</h2>
      <form id="form-login">
        <div class="form-group">
          <label for="login-email">Correo electrónico</label>
          <input type="email" id="login-email" placeholder="ejemplo@correo.com" required>
        </div>
        <div class="form-group">
          <label for="login-password">Contraseña</label>
          <input type="password" id="login-password" placeholder="********" required>
        </div>
        <button type="submit">Entrar</button>
        <div class="msg" id="login-msg"></div>
      </form>
      <div style="margin-top:12px;text-align:center;">
        <small>¿No tienes cuenta? <a href="#" id="show-register" style="color:#ff6363;cursor:pointer;">Regístrate aquí</a></small>
      </div>
    </div>

    <div id="register-panel" class="panel" style="display:none;max-width:430px;">
      <h2>Registrarse</h2>
      <form id="form-register">
        <div class="form-group">
          <label for="reg-email">Correo electrónico</label>
          <input type="email" id="reg-email" required>
        </div>
        <div class="form-group">
          <label for="reg-password">Contraseña</label>
          <input type="password" id="reg-password" required>
        </div>
        <div class="form-group">
          <label for="reg-nombre">Nombre completo</label>
          <input type="text" id="reg-nombre" required>
        </div>
        <button type="submit">Registrarme</button>
        <div class="msg" id="register-msg"></div>
      </form>
      <div style="margin-top:12px;text-align:center;">
        <small>¿Ya tienes cuenta? <a href="#" id="show-login" style="color:#ff6363;cursor:pointer;">Inicia sesión</a></small>
      </div>
    </div>

    <!-- Secciones principales -->
    <div id="trading" style="display:none;">
      <div class="panel" style="max-width:850px;">
        <h2>Trading</h2>
        <p style="font-size:1.1em;">Gráfico de TradingView:</p>
        <iframe src="https://s.tradingview.com/widgetembed/?frameElementId=tradingview_c7d4b&symbol=FX:EURUSD&interval=D&symboledit=1&saveimage=1&toolbarbg=f1f3f6&studies=[]&theme=dark&style=1&timezone=Etc/UTC&studies_overrides={}&overrides={}&enabled_features=[]&disabled_features=[]&locale=es" width="100%" height="340" frameborder="0"></iframe>
      </div>
    </div>

    <div id="deposito" style="display:none;">
      <div class="panel">
        <h2>Depósito</h2>
        <form id="form-deposito">
          <div class="form-group">
            <label for="pais-deposito">Selecciona tu país</label>
            <select id="pais-deposito" required>
              <option value="">--Selecciona--</option>
              <option>Colombia</option>
              <option>Perú</option>
              <option>México</option>
            </select>
          </div>
          <div class="form-group">
            <label for="monto-deposito">Monto a depositar (USD)</label>
            <input type="number" id="monto-deposito" placeholder="Ej: 100" min="1" required>
          </div>
          <button type="submit">Depositar</button>
          <div class="msg" id="deposito-msg"></div>
        </form>
      </div>
    </div>

    <div id="retiro" style="display:none;">
      <div class="panel">
        <h2>Retiro</h2>
        <form id="form-retiro">
          <div class="form-group">
            <label for="banco">Banco</label>
            <input type="text" id="banco" placeholder="Nombre del banco" required>
          </div>
          <div class="form-group">
            <label for="pais-retiro">País</label>
            <select id="pais-retiro" required>
              <option value="">--Selecciona--</option>
              <option>Colombia</option>
              <option>Perú</option>
              <option>México</option>
            </select>
          </div>
          <div class="form-group">
            <label for="cuenta">Cuenta o tarjeta</label>
            <input type="text" id="cuenta" placeholder="Número de cuenta o tarjeta" required>
          </div>
          <div class="form-group">
            <label for="monto-retiro">Monto a retirar (USD)</label>
            <input type="number" id="monto-retiro" placeholder="Ej: 50" min="1" required>
          </div>
          <button type="submit">Solicitar Retiro</button>
          <div class="msg" id="retiro-msg"></div>
        </form>
      </div>
    </div>

    <!-- Panel admin -->
    <div id="admin" style="display:none;">
      <div class="panel" style="max-width:900px;">
        <h2>Panel de Administración</h2>
        <p>Usuarios registrados pendientes de aprobación:</p>
        <table class="users-table" id="admin-users-table">
          <thead>
            <tr>
              <th>Email</th>
              <th>Nombre</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <!-- JS renderiza aquí -->
          </tbody>
        </table>
        <div class="msg" id="admin-msg"></div>
      </div>
    </div>
  </section>
</main>

<footer>
  &copy; 2025 Iron Fx Recovery. Todos los derechos reservados.
</footer>

<script>
const ADMIN_USER = "admin@ironfx.com";
const ADMIN_PASS = "admin123";

function getUsers() {
  try {
    return JSON.parse(localStorage.getItem("ifx_users") || "[]");
  } catch { return []; }
}
function setUsers(users) {
  localStorage.setItem("ifx_users", JSON.stringify(users));
}
function getSession() {
  try {
    return JSON.parse(localStorage.getItem("ifx_session") || "null");
  } catch { return null; }
}
function setSession(user) {
  if(user) localStorage.setItem("ifx_session", JSON.stringify(user));
  else localStorage.removeItem("ifx_session");
}
function showSection(section) {
  for(const sec of ["trading","deposito","retiro","admin"]) {
    document.getElementById(sec).style.display = (sec===section)?"block":"none";
    const btn=document.querySelector('.sidebar-nav [data-section="'+sec+'"]');
    if(btn) btn.classList.toggle("active",sec===section);
  }
}

function renderAdminUsers() {
  const tbody = document.getElementById("admin-users-table").querySelector("tbody");
  const users = getUsers();
  tbody.innerHTML = "";
  users.forEach((u,i) => {
    if (u.email === ADMIN_USER) return; // no mostrar admin
    let tr = document.createElement("tr");
    tr.className = u.estado==="aprobado"?"approved":(u.estado==="rechazado"?"rejected":"");
    tr.innerHTML = `
      <td>${u.email}</td>
      <td>${u.nombre||"-"}</td>
      <td>${u.estado||"pendiente"}</td>
      <td class="admin-actions">
        ${u.estado==="pendiente"?`
        <button class="approve" data-idx="${i}">Aprobar</button>
        <button class="reject" data-idx="${i}">Rechazar</button>
        `:""}
      </td>`;
    tbody.appendChild(tr);
  });
  document.querySelectorAll('.admin-actions .approve').forEach(btn=>{
    btn.onclick = function(){
      let idx = +btn.dataset.idx;
      let users = getUsers();
      users[idx].estado = "aprobado";
      setUsers(users);
      renderAdminUsers();
      document.getElementById("admin-msg").textContent = "Usuario aprobado.";
      setTimeout(()=>{document.getElementById("admin-msg").textContent="";},1500);
    }
  });
  document.querySelectorAll('.admin-actions .reject').forEach(btn=>{
    btn.onclick = function(){
      let idx = +btn.dataset.idx;
      let users = getUsers();
      users[idx].estado = "rechazado";
      setUsers(users);
      renderAdminUsers();
      document.getElementById("admin-msg").textContent = "Usuario rechazado.";
      setTimeout(()=>{document.getElementById("admin-msg").textContent="";},1500);
    }
  });
}

function checkSidebar() {
  // Si sesion activa
  const session = getSession();
  if(session) {
    document.getElementById("sidebar").style.display = "flex";
    if(session.isAdmin){
      document.getElementById("adminPanelBtn").style.display = "block";
    } else {
      document.getElementById("adminPanelBtn").style.display = "none";
    }
  } else {
    document.getElementById("sidebar").style.display = "none";
  }
}

function showLogin() {
  document.getElementById("register-panel").style.display = "none";
  document.getElementById("login-panel").style.display = "block";
  document.getElementById("content-area").style.justifyContent = "center";
  for(const sec of ["trading","deposito","retiro","admin"]) document.getElementById(sec).style.display = "none";
  checkSidebar();
}
function showRegister() {
  document.getElementById("login-panel").style.display = "none";
  document.getElementById("register-panel").style.display = "block";
  document.getElementById("content-area").style.justifyContent = "center";
}

// EVENTOS DE LOGIN Y REGISTRO
document.getElementById("show-register").onclick = function(e){e.preventDefault();showRegister();}
document.getElementById("show-login").onclick = function(e){e.preventDefault();showLogin();}

// Login
document.getElementById("form-login").onsubmit = function(e) {
  e.preventDefault();
  const email = document.getElementById("login-email").value.trim().toLowerCase();
  const pass = document.getElementById("login-password").value;
  const msg = document.getElementById("login-msg");
  msg.textContent = "";
  // Admin
  if(email===ADMIN_USER && pass===ADMIN_PASS){
    setSession({email,isAdmin:true,nombre:"Administrador"});
    document.getElementById("login-panel").style.display="none";
    checkSidebar();
    showSection("admin");
    document.getElementById("content-area").style.justifyContent = "flex-start";
    return;
  }
  // Usuarios
  const users = getUsers();
  const user = users.find(u=>u.email===email);
  if(!user){
    msg.textContent = "Usuario no registrado.";
    msg.className = "msg error";
    return;
  }
  if(user.password!==pass){
    msg.textContent = "Contraseña incorrecta.";
    msg.className = "msg error";
    return;
  }
  if(user.estado==="rechazado"){
    msg.textContent = "Registro rechazado. Contacta soporte.";
    msg.className = "msg error";
    return;
  }
  if(user.estado!=="aprobado"){
    msg.textContent = "Tu cuenta aún no ha sido aprobada por el administrador.";
    msg.className = "msg error";
    return;
  }
  setSession({email: user.email, nombre: user.nombre, isAdmin:false});
  document.getElementById("login-panel").style.display="none";
  checkSidebar();
  showSection("trading");
  document.getElementById("content-area").style.justifyContent = "flex-start";
};

// Registro
document.getElementById("form-register").onsubmit = function(e) {
  e.preventDefault();
  const email = document.getElementById("reg-email").value.trim().toLowerCase();
  const password = document.getElementById("reg-password").value;
  const nombre = document.getElementById("reg-nombre").value.trim();
  const msg = document.getElementById("register-msg");
  msg.textContent = "";
  if(!email || !password || !nombre){
    msg.textContent = "Completa todos los campos.";
    msg.className = "msg error";
    return;
  }
  if(email===ADMIN_USER){
    msg.textContent = "No puedes registrar este correo.";
    msg.className = "msg error";
    return;
  }
  let users = getUsers();
  if(users.find(u=>u.email===email)){
    msg.textContent = "Este correo ya está registrado.";
    msg.className = "msg error";
    return;
  }
  users.push({email, password, nombre, estado:"pendiente"});
  setUsers(users);
  msg.textContent = "Registro realizado. Espera aprobación del administrador.";
  msg.className = "msg success";
  setTimeout(()=>{showLogin();}, 1600);
};

// Menú lateral navegación
document.querySelectorAll('.sidebar-nav button[data-section]').forEach(btn=>{
  btn.onclick = function(){
    const sec = btn.getAttribute('data-section');
    showSection(sec);
    if(sec==="admin") renderAdminUsers();
  }
});

// Depósito
document.getElementById('form-deposito').addEventListener('submit', function(e){
  e.preventDefault();
  const pais = document.getElementById('pais-deposito').value;
  const monto = document.getElementById('monto-deposito').value;
  const msg = document.getElementById('deposito-msg');
  if(!pais || !monto || monto <= 0){
    msg.textContent = "Completa todos los datos correctamente.";
    msg.className = "msg error";
    return;
  }
  msg.textContent = `¡Depósito realizado por USD ${monto}!`;
  msg.className = "msg success";
  this.reset();
  setTimeout(()=>{msg.textContent="";},1400);
});

// Retiro
document.getElementById('form-retiro').addEventListener('submit', function(e){
  e.preventDefault();
  const banco = document.getElementById('banco').value.trim();
  const pais = document.getElementById('pais-retiro').value;
  const cuenta = document.getElementById('cuenta').value.trim();
  const monto = document.getElementById('monto-retiro').value;
  const msg = document.getElementById('retiro-msg');
  if(!banco || !pais || !cuenta || !monto || monto <= 0){
    msg.textContent = "Completa todos los datos correctamente.";
    msg.className = "msg error";
    return;
  }
  msg.textContent = `¡Retiro solicitado por USD ${monto}!`;
  msg.className = "msg success";
  this.reset();
  setTimeout(()=>{msg.textContent="";},1400);
});

// Cerrar sesión
document.getElementById('logout-btn').addEventListener('click', function(){
  setSession(null);
  showLogin();
});

// Al cargar, mostrar login o mantener sesión
window.onload = function(){
  let session = getSession();
  if(session){
    checkSidebar();
    if(session.isAdmin){
      showSection("admin");
      renderAdminUsers();
      document.getElementById("content-area").style.justifyContent = "flex-start";
    } else {
      showSection("trading");
      document.getElementById("content-area").style.justifyContent = "flex-start";
    }
    document.getElementById("login-panel").style.display = "none";
    document.getElementById("register-panel").style.display = "none";
  } else {
    showLogin();
  }
}
</script>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
      .then(reg => console.log('Service Worker registrado', reg))
      .catch(err => console.error('Error registrando SW', err));
  }
</script>
</body>
</html>